<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Structured geocoding — structured • photon</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Structured geocoding — structured"><meta name="description" content="Geocode a set of place information such as street, house number, or
post code. Structured geocoding is generally more accurate but requires
more information than unstructured geocoding.
Note that structured geocoding must be specifically enabled when building a
Nominatim database. It is generally not available on komoot's public API and
on pre-built search indices through download_searchindex. See
vignette(&quot;nominatim-import&quot;, package = &quot;photon&quot;) for details. You can
use the helper function has_structured_support() to check if the
current API supports structured geocoding."><meta property="og:description" content="Geocode a set of place information such as street, house number, or
post code. Structured geocoding is generally more accurate but requires
more information than unstructured geocoding.
Note that structured geocoding must be specifically enabled when building a
Nominatim database. It is generally not available on komoot's public API and
on pre-built search indices through download_searchindex. See
vignette(&quot;nominatim-import&quot;, package = &quot;photon&quot;) for details. You can
use the helper function has_structured_support() to check if the
current API supports structured geocoding."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">photon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span> Overview</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/photon.html"><span class="fa fa-book"></span> Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/nominatim-import.html"><span class="fa fa-database"></span> Import from Nominatim</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-search"></span> Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jslth/photon/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Structured geocoding</h1>
      <small class="dont-index">Source: <a href="https://github.com/jslth/photon/blob/v0.3.1/R/structured.R" class="external-link"><code>R/structured.R</code></a></small>
      <div class="d-none name"><code>structured.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Geocode a set of place information such as street, house number, or
post code. Structured geocoding is generally more accurate but requires
more information than <a href="geocode.html">unstructured geocoding</a>.</p>
<p>Note that structured geocoding must be specifically enabled when building a
Nominatim database. It is generally not available on komoot's public API and
on pre-built search indices through <code><a href="download_searchindex.html">download_searchindex</a></code>. See
<code><a href="../articles/nominatim-import.html">vignette("nominatim-import", package = "photon")</a></code> for details. You can
use the helper function <code>has_structured_support()</code> to check if the
current API supports structured geocoding.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">structured</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"en"</span>,</span>
<span>  bbox <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  osm_tag <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  locbias <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  locbias_scale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  zoom <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  progress <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">has_structured_support</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>Dataframe or list containing structured information on a place
to geocode. Can contain the columns <code>street</code>, <code>housenumber</code>,
<code>postcode</code>, <code>city</code>, <code>district</code>, <code>county</code>, <code>state</code>,
and <code>countrycode</code>. At least one of these columns must be present in the
dataframe. Note that countries must be passed as ISO-2 country codes.</p></dd>


<dt id="arg-limit">limit<a class="anchor" aria-label="anchor" href="#arg-limit"></a></dt>
<dd><p>Number of results to return. Defaults to 3.</p></dd>


<dt id="arg-lang">lang<a class="anchor" aria-label="anchor" href="#arg-lang"></a></dt>
<dd><p>Language of the results.</p></dd>


<dt id="arg-bbox">bbox<a class="anchor" aria-label="anchor" href="#arg-bbox"></a></dt>
<dd><p>Any object that can be parsed by <code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></code>.
Results must lie within this bbox.</p></dd>


<dt id="arg-osm-tag">osm_tag<a class="anchor" aria-label="anchor" href="#arg-osm-tag"></a></dt>
<dd><p>Character string giving an
<a href="https://wiki.openstreetmap.org/wiki/Tags" class="external-link">OSM tag</a> to filter the
results by. See details.</p></dd>


<dt id="arg-layer">layer<a class="anchor" aria-label="anchor" href="#arg-layer"></a></dt>
<dd><p>Character string giving a layer to filter the results by.
Can be one of <code>"house"</code>, <code>"street"</code>, <code>"locality"</code>,
<code>"district"</code>, <code>"city"</code>, <code>"county"</code>, <code>"state"</code>,
<code>"country"</code>, or <code>"other"</code>.</p></dd>


<dt id="arg-locbias">locbias<a class="anchor" aria-label="anchor" href="#arg-locbias"></a></dt>
<dd><p>Numeric vector of length 2 or any object that can be coerced
to a length-2 numeric vector (e.g. a list or <code>sfg</code> object). Specifies a
location bias for geocoding in the format <code>c(lon, lat)</code>. Geocoding
results are biased towards this point. The radius of the bias is controlled
through <code>zoom</code> and the weight of place prominence through
<code>location_bias_scale</code>.</p></dd>


<dt id="arg-locbias-scale">locbias_scale<a class="anchor" aria-label="anchor" href="#arg-locbias-scale"></a></dt>
<dd><p>Numeric vector specifying the importance of prominence
in <code>locbias</code>. A higher prominence scale gives more weight to important
places. Defaults to 0.2.</p></dd>


<dt id="arg-zoom">zoom<a class="anchor" aria-label="anchor" href="#arg-zoom"></a></dt>
<dd><p>Numeric specifying the radius for which the <code>locbias</code> is
effective. Corresponds to the zoom level in OpenStreetMap. The exact relation
to <code>locbias</code> is \(0.25\text{ km} \cdot 2^{(18 - \text{zoom})}\).
Defaults to 16.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>If <code>TRUE</code>, shows a progress bar for longer queries.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An sf dataframe or tibble containing the following columns:</p>
<ul><li><p><code>idx</code>: Internal ID specifying the index of the <code>texts</code>
 parameter.</p></li>
<li><p><code>osm_type</code>: Type of OSM element, one of N (node), W (way),
 R (relation), or P (polygon).</p></li>
<li><p><code>osm_id</code>: OpenStreetMap ID of the matched element.</p></li>
<li><p><code>country</code>: Country of the matched place.</p></li>
<li><p><code>city</code>: City of the matched place.</p></li>
<li><p><code>osm_key</code>: OpenStreetMap key.</p></li>
<li><p><code>countrycode</code>: ISO2 country code.</p></li>
<li><p><code>housenumber</code>: House number, if applicable.</p></li>
<li><p><code>postcode</code>: Post code, if applicable.</p></li>
<li><p><code>locality</code>: Locality, if applicable.</p></li>
<li><p><code>street</code>: Street, if applicable.</p></li>
<li><p><code>district</code>: District name, if applicable.</p></li>
<li><p><code>osm_value</code>: OpenStreetMap tag value.</p></li>
<li><p><code>name</code>: Place name.</p></li>
<li><p><code>type</code>: Layer type as described for the <code>layer</code> parameter.</p></li>
<li><p><code>extent</code>: Boundary box of the match.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Filtering by OpenStreetMap tags follows a distinct syntax explained on
<a href="https://github.com/komoot/photon" class="external-link">https://github.com/komoot/photon</a>. In particular:</p>
<ul><li><p>Include places with tag: <code>key:value</code></p></li>
<li><p>Exclude places with tag: <code>!key:value</code></p></li>
<li><p>Include places with tag key: <code>key</code></p></li>
<li><p>Include places with tag value: <code>:value</code></p></li>
<li><p>Exclude places with tag key: <code>!key</code></p></li>
<li><p>Exclude places with tag value: <code>:!value</code></p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># structured() requires an OpenSearch instance with structured support</span></span></span>
<span class="r-in"><span><span class="co"># the following code will not work off the shelf</span></span></span>
<span class="r-in"><span><span class="co"># refer to vignette("nominatim-import") for details</span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"photon"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">photon</span> <span class="op">&lt;-</span> <span class="fu"><a href="new_photon.html">new_photon</a></span><span class="op">(</span><span class="va">dir</span>, opensearch <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">photon</span><span class="op">$</span><span class="fu">import</span><span class="op">(</span>password <span class="op">=</span> <span class="st">"psql_password"</span>, structured <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">photon</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check if structured() is supported</span></span></span>
<span class="r-in"><span><span class="fu">has_structured_support</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># structured() works on dataframes containing structurized data</span></span></span>
<span class="r-in"><span><span class="va">place_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  housenumber <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"77C"</span>, <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  street <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Falealilli Cross Island Road"</span>, <span class="st">"Main Beach Road"</span>, <span class="st">"Le Mafa Pass Road"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tuamasaga"</span>, <span class="st">"Tuamasaga"</span>, <span class="st">"Atua"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">structured</span><span class="op">(</span><span class="va">place_data</span>, limit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># countries must be specified as iso2 country codes</span></span></span>
<span class="r-in"><span><span class="fu">structured</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>countrycode <span class="op">=</span> <span class="st">"ws"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># traditional parameters from geocode() can also be used but are much more niche</span></span></span>
<span class="r-in"><span><span class="fu">structured</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>city <span class="op">=</span> <span class="st">"Apia"</span><span class="op">)</span>, layer <span class="op">=</span> <span class="st">"house"</span><span class="op">)</span> <span class="co"># matches nothing</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># structured geocoding can discern small differences in places</span></span></span>
<span class="r-in"><span><span class="va">safune</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Safune"</span>, <span class="st">"Safune"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gaga'ifomauga"</span>, <span class="st">"Tuamasaga"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">structured</span><span class="op">(</span><span class="va">safune</span>, limit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonas Lieth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

